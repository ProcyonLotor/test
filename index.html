<h<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.1/css/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.1/build/ol.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.4/proj4.js"></script>
	<script src="https://epsg.io/2056.js"></script>
	<script type="text/javascript"></script>
	<style>
      .map {
        width: 100%;
        height:800px;
      }
    </style>
    <title>Web mapping</title>
  </head>
  <body>
    <h2>Mes débuts en webmapping</h2>
    <div id="map" class="map"></div>
      
	<div id="dessin-button">
	<button onclick="add_creer()">Dessiner</button>
	</div>
      
    <div id="stop-button">
	<button onclick="stop()">Stop</button>
	</div>
      
    <div id="modify-button">
	<button onclick="add_modify()">Modifier</button>
	</div>
      
	<div id="raster-button">
	<button onclick="raster_switch()">OpenStreetMap</button>
	</div>
      
	<button onclick="satelitte_switch()">GoogleSatelitte</button>
	</div>
	<form class="form-inline">
      <label>Geometry type &nbsp;</label>
      <select id="type">
        <option value="Point">Point</option>
        <option value="LineString">LineString</option>
        <option value="Polygon">Polygon</option>
        <option value="Circle">Circle</option>
        <option value="None">None</option>
      </select>
    </form>
    <script type="text/javascript"> // Code JS
 

proj4.defs("EPSG:2056","+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs");
        
        
var swissProjection = new ol.proj.Projection({
    code: 'EPSG:2056',
    // The extent is used to determine zoom level 0. Recommended values for a
    // projection's validity extent can be found at https://epsg.io/.
    //extent: [2485869.5728, 1076443.1884, 2837076.5648, 1299941.7864],
    units: 'm',
		  getPointResolution: function(resolution) {
    return resolution;
  }
}); 

const BienneLonLat = [ 7.251713, 47.131105];
const BienneWebMercator = ol.proj.fromLonLat(BienneLonLat);
    
var snap, draw, stop, modify;
        

        
var vector = new ol.layer.Vector({
    source: new ol.source.Vector({
        url:'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson',
        format: new ol.format.GeoJSON(),
    })
});
    
var Satelitte = new ol.layer.Tile({ // Ajout d'un fichier google satelitte XYZ
		 title: "Satelitte",
         source: new ol.source.XYZ({
         url: 'http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}',
         }),
            visible: true,
            is_base_layer: true
           });
Satelitte.setOpacity(0.5)

var raster = new ol.layer.Tile({ //Ajout d'un font de carte OpenStreetMap
				title: "OSM",
				visible: false,
				source: new ol.source.OSM(),
				type:'base'
	});
var Boundaries = new ol.layer.Image({
		title: "Boundaries",
		type: "base",
		source: new ol.source.ImageWMS({
		url: 'http://localhost:8080/geoserver/web_map/wms',
		params:{'LAYERS':'web_map:swiss_boundaries'},
		serverType:'geoserver'
	 })
	 });
Boundaries.setOpacity(0.4)
var PPS = new ol.layer.Image({
	 title: "PPS",
	 type: "base",
	 source: new ol.source.ImageWMS({
	 url: 'http://localhost:8080/geoserver/web_map/wms',
	 params:{'LAYERS':'web_map:Prairies et pâturages secs'},// très important que le nom soit celui de geoserver dans "Prévisualisation de couche"
	 serverType:'geoserver'
	 })
	});
        
var mousePositionControl = new ol.control.MousePosition({
        coordinateFormat: ol.coordinate.createStringXY(4),
        projection: swissProjection,
        target: document.getElementById('mouse-position'),
        undefinedHTML: '&nbsp;'
});
        
const map = new ol.Map({
	controls: ol.control.defaults({
		attribution : true,
		}).extend([new ol.control.ScaleLine(), 
				   mousePositionControl, 
				   new ol.control.ZoomSlider // affichage de l'échelle
				]),
		target: 'map',
        layers: [raster, Satelitte, Boundaries, PPS, vector],
	    view: new ol.View({
                center: BienneWebMercator,
                resolution: 100,

        })
});
map.addControl(new ol.control.LayerSwitcher()); // map.addLayer(swiss_boundaries); <-- Autre manière d'ajouter une couche dans la map

function raster_switch(){  
	if(raster.getVisible()){ // Si le raster est visible
	raster.setVisible(false) // Nous l'éteignons
	}
	else{
	raster.setVisible(true) // Sinon nous l'affichons
	}
	}

function satelitte_switch(){  
	if(Satelitte.getVisible()){ // Si le raster est visible
	Satelitte.setVisible(false) // Nous l'éteignons
	}
	else{
	Satelitte.setVisible(true) // Sinon nous l'affichons
	}
	}
        
function add_snap(){
	snap = new ol.interaction.Snap({
	source: vector.getSource()
	});
	map.addInteraction(snap)
	}

function add_creer(){
	draw = new ol.interaction.Draw({
	source: vector.getSource(),
	type: "Polygon",
	});
    map.addInteraction(draw)
    add_snap()
	
	}
        
        
function add_modify(){
    stop();
    modify = new ol.interaction.Modify({
        source: vector.getSource()
    });
	map.addInteraction(modify)
    add_snap();
	}
        
function stop(){
	map.removeInteraction(draw);
    map.removeInteraction(snap);
    map.removeInteraction(modify);
	}
        
// Export PDF

        
        
/*
        console.log(osmLayer.getSource());
        osmLayer.setProperties({opacity: 0.4, contrast:0.6});
        console.log(osmLayer.get('contrast'));
        console.log(osmLayer.get('opacity'));
        osmLayer.setProperties({opacity: 0.7, contrast:0.3});
        console.log(osmLayer.getOpacity());
        console.log(osmLayer.getContrast());
        osmLayer.set('opacity',1);
        osmLayer.setContrast(1);
        osmLayer.setBrightness(0);
        osmLayer.set('myId', 'myUnique');
        console.log(osmLayer.get('myId'));
        */
    </script>
  </body>
</html>

